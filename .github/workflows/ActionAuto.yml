name: Sync GitHub to Server

on:
  push:
    branches:
      - master  # Change this to the branch you want to trigger the sync

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source code
        uses: actions/checkout@v2
        with:
          repository: musmanshamshad/DevOpsLearningAutomation  # Updated source repository URL
          ref: master
            # Replace with the source branch

      - name: Configure SSH key for server repo
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.MYSECRETKEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan github.com >> ~/.ssh/known_hosts
        env:
          MYSECRETKEY: ${{ secrets.MYSECRETKEY }}

      - name: Copy code to server repository
        run: |
          cp -r DevOpsLearningAutomation/* /home/ubuntu/autodep/  # Copy the code from source to server repo
        env:
          MYSECRETKEY: ${{ secrets.MYSECRETKEY }}
